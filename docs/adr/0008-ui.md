
# 0008 â€“ Theming Engine & Component Design System

**Date:** 2025-12-05
**Status:** Approved

## 1. Context

LemOS has successfully established a logical architecture (Event Bus, Modules), but the **visual architecture** is fragmented.
- Modules implement their own ad-hoc CSS.
- There is no consistent way to handle "Planetary Modes" (e.g., switching the whole UI from "Solar Gold" to "Lunar Silver").
- UI quality is inconsistent, leading to "developer art" fatigue.

We need a centralized Design System that handles **Atomic Components** (buttons, panels, inputs) and a **Theming Engine** that reacts to system state (Planets/Scenes).

## 2. Decision

We will elevate `@lemos/ui` from a placeholder to a fully-featured **Design System Package**.

### 2.1 Theming Strategy: CSS Variables + React Context
We will use **CSS Custom Properties (Variables)** as the source of truth for all styling tokens.
*   **Why:** Performance (no JS runtime cost for theme switches) and portability (works in React, Tauri, and raw HTML if needed).
*   **Tokens:** We will define semantic tokens, not just raw values.
    *   `--color-bg-canvas` (not just `#000`)
    *   `--color-accent-primary`
    *   `--font-family-mono`
    *   `--space-unit`

### 2.2 Planetary Modes as Themes
The Theming Engine will explicitly support **Mode Switching**.
*   `Mars Mode`: High contrast, red/black, aggressive sharp corners.
*   `Venus Mode`: Softer, green/copper, rounded corners.
*   `Void Mode`: Minimalist, pure black/white, high transparency.

These are not just "Dark/Light" modes; they are **Archetypal Themes** that change fonts, spacing, and colors.

### 2.3 Component Architecture (Atomic Design)
All modules must import UI elements from `@lemos/ui`.
*   **Atoms:** `Button`, `Input`, `Toggle`, `Icon`.
*   **Molecules:** `Panel` (standard window wrapper), `Card`, `List`.
*   **Organisms:** `ModuleShell` (standard layout for a module's screen real estate).

---

## 3. Implementation Details

### 3.1 The `ThemeEngine` Component
A provider that listens to the `ContextModule` (via Event Bus) and applies class names to the root `<html>` or `<body>` tag.

```tsx
// packages/ui/src/ThemeEngine.tsx
import { useEffect } from "react";

export const ThemeEngine = ({ mode }: { mode: 'mars' | 'venus' | 'void' }) => {
  useEffect(() => {
    document.documentElement.setAttribute('data-theme', mode);
  }, [mode]);
  return null;
};
```

### 3.2 CSS Architecture
We will use **Tailwind CSS** (configured with our tokens) OR **Vanilla Extract** (TypeScript-to-CSS).
*   *Decision:* **Tailwind CSS** is recommended for speed of iteration in Phase 1, using a custom `tailwind.config.js` that maps to our CSS variables.

**Example `globals.css`:**
```css
:root {
  --radius-panel: 0px;
}
[data-theme="venus"] {
  --color-accent: #e2b46a;
  --radius-panel: 12px; /* Softness */
}
[data-theme="mars"] {
  --color-accent: #ff4400;
  --radius-panel: 0px; /* Sharpness */
}
```

### 3.3 The Standard `ModulePanel`
Every module must wrap its UI in this component to ensure it looks integrated.

```tsx
export const ModulePanel = ({ title, actions, children }) => (
  <div className="border border-accent bg-surface p-4 rounded-panel">
    <header className="flex justify-between border-b border-accent/20 mb-4 pb-2">
      <h2 className="text-xl font-display">{title}</h2>
      <div>{actions}</div>
    </header>
    <div className="font-mono">{children}</div>
  </div>
);
```

---

## 4. Migration Plan

1.  **Setup Storybook:**
    *   Initialize Storybook in `packages/ui` (or `apps/ui-playground`).
    *   Create a "Theme Switcher" toolbar item in Storybook to test Planetary Modes.
2.  **Define Tokens:**
    *   Create `tokens/colors.ts`, `tokens/typography.ts`.
3.  **Build Atoms:**
    *   Refactor the existing "Start Focus" button to use `<Button variant="primary" />`.
4.  **Refactor Modules:**
    *   Go through `session-timer`, `ritual-editor`, `dopamine-hero`.
    *   Replace `<div>` and `<button>` with imported components.
    *   Remove module-specific CSS files.

---

## 5. Consequences

### Positive
*   **Consistency:** The "Module Select Map" you build next will immediately look correct.
*   **Atmosphere:** Switching to "Night Mode" (or Moon Mode) effectively changes the psychological vibe of the OS, reinforcing the ritual aspect.
*   **Speed:** Building new modules becomes faster because you just glue pre-styled components together.

### Negative
*   **Strictness:** You cannot just "throw a div on screen" anymore; you must use the system.
*   **Refactor Debt:** We have to pause feature work to rewrite the UI of Phase 0/1 modules.

---

## 6. Success Criteria

*   Storybook is running and shows Button/Input in Mars, Venus, and Void modes.
*   The `SessionTimer` module uses the new components.
*   Changing the Planetary Mode in the global config instantly updates all colors/fonts without a reload.
